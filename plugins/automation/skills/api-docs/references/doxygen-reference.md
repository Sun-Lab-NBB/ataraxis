# Doxygen and Breathe reference

Configuration reference for C++ documentation using the Doxygen-Breathe-Sphinx pipeline. Applies
to C++-only and hybrid archetype projects.

---

## Pipeline overview

The C++ documentation pipeline works in three stages:

1. **Doxygen** parses C++ source files and generates XML documentation
2. **Breathe** bridges the Doxygen XML output into the Sphinx documentation system
3. **Sphinx** renders the combined Python and C++ documentation as HTML

The tox `[testenv:docs]` runs these stages sequentially: `doxygen Doxyfile` followed by the
Sphinx build command.

---

## Doxyfile template

The `Doxyfile` is placed at the project root (not inside `docs/`). Replace `<PLACEHOLDER>`
values with project-specific information.

### Minimal configuration

```text
# This configuration file specifies how Doxygen should parse the docstrings inside the C++ source code files.
# It is used as part of the tox-automated project building workflow to generate API documentation for extension code.
# Currently, this file provide the minimal configuration necessary to build the .xml documentation file that is then
# parsed and merged with python code documentation by sphinx via 'breathe' bridge.

DOXYFILE_ENCODING      = UTF-8
PROJECT_NAME           = "<PROJECT_NAME>"
OUTPUT_DIRECTORY       = docs/source/doxygen
OUTPUT_LANGUAGE        = English
INPUT                  = <INPUT_PATHS>
GENERATE_XML           = YES
XML_OUTPUT             = xml
```

### With preprocessor macros

If the project uses C/C++ macros that Doxygen needs to expand for correct documentation
parsing, add these settings:

```text
ENABLE_PREPROCESSING   = YES
MACRO_EXPANSION        = YES
EXPAND_ONLY_PREDEF     = NO
PREDEFINED             = <MACRO_DEFINITIONS>
```

### Optional output control

To suppress LaTeX output generation (recommended when only XML is needed):

```text
GENERATE_LATEX         = NO
```

### Placeholders

| Placeholder           | Description                                 | Example              |
|-----------------------|---------------------------------------------|----------------------|
| `<PROJECT_NAME>`      | Project display name (may differ from PyPI) | `ataraxis-timer`     |
| `<INPUT_PATHS>`       | Space-separated paths to C++ source files   | `src/c_extensions`   |
| `<MACRO_DEFINITIONS>` | Space-separated macro expansions            | `PACKED_STRUCT=`     |

### INPUT path conventions

- Use relative paths from the project root.
- For a single directory containing all source files: `INPUT = src/c_extensions`
- For specific files, list them with backslash continuation:

```text
INPUT                  = src/header1.h \
                         src/header2.h \
                         src/implementation.cpp
```

---

## Breathe configuration in conf.py

Breathe configuration is placed in `conf.py` after the extensions list.

### Basic configuration

```python
breathe_projects = {"<PROJECT_NAME>": "./doxygen/xml"}
breathe_default_project = "<PROJECT_NAME>"
```

The path `./doxygen/xml` is relative to `docs/source/` (the Sphinx source directory), pointing
to the XML output generated by Doxygen at `docs/source/doxygen/xml/`.

### With preprocessor options

```python
breathe_projects = {"<PROJECT_NAME>": "./doxygen/xml"}
breathe_default_project = "<PROJECT_NAME>"
breathe_doxygen_config_options = {
    'ENABLE_PREPROCESSING': 'YES',
    'MACRO_EXPANSION': 'YES',
    'EXPAND_ONLY_PREDEF': 'NO',
    'PREDEFINED': '<MACRO_DEFINITIONS>'
}
```

**Note:** Preprocessor options can be specified in either the Doxyfile or via
`breathe_doxygen_config_options` in conf.py. Using `breathe_doxygen_config_options` overrides
the corresponding Doxyfile settings. Choose one location and be consistent within a project.

---

## tox.ini configuration for C++ projects

### C++-only projects

C++-only projects use `skip_install = true` since there is no Python package to install:

```ini
[testenv:docs]
skip_install = true
description =
    Builds the API documentation from source code docstrings using Doxygen, Breathe and Sphinx.
    The result can be viewed by loading 'docs/build/html/index.html'.
deps = ataraxis-automation==VERSION
allowlist_externals = doxygen
commands =
    doxygen Doxyfile
    sphinx-build -b html -d docs/build/doctrees docs/source docs/build/html -j auto -v
```

### Hybrid projects

Hybrid projects install normally (no `skip_install`) since autodoc needs the Python package:

```ini
[testenv:docs]
description =
    Builds the API documentation from source code docstrings using Doxygen, Breathe and Sphinx.
    The result can be viewed by loading 'docs/build/html/index.html'.
deps = ataraxis-automation==VERSION
depends = uninstall
allowlist_externals = doxygen
commands =
    doxygen Doxyfile
    sphinx-build -b html -d docs/build/doctrees docs/source docs/build/html -j auto -v
```

### Key differences

| Setting               | C++-only       | Hybrid         |
|-----------------------|----------------|----------------|
| `skip_install`        | `true`         | Not set        |
| `depends`             | Not set        | `uninstall`    |
| `allowlist_externals` | `doxygen`      | `doxygen`      |
| `deps`                | Pinned version | Pinned version |

Replace `VERSION` with the current `ataraxis-automation` release version (e.g., `7.1.0`).
